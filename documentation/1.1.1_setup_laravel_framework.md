# Setup Laravel Framework for KMKB Application

## Overview
This document provides a step-by-step guide for setting up the Laravel PHP framework for the KMKB application using aaPanel on your Hostinger VPS. Laravel is recommended in the BRD as the preferred framework due to its robust ecosystem, built-in features for authentication, database migrations, and security.

## Prerequisites
- Completed environment setup with aaPanel, PHP, MySQL, and Apache/Nginx
- aaPanel version 6.0 or higher
- PHP 8.1 or higher (as recommended by Laravel)
- Composer installed (will be installed during this process if not already present)

## Installing Laravel via aaPanel

### Step 1: Access aaPanel
1. Log in to your aaPanel interface using the credentials saved during installation
2. Navigate to the main dashboard

### Step 2: Install Composer (if not already installed)
1. In aaPanel, go to "Files" → "Terminal"
2. Check if Composer is installed:
   ```bash
   composer --version
   ```
3. If Composer is not installed, install it:
   ```bash
   cd /tmp
   curl -sS https://getcomposer.org/installer | php
   sudo mv composer.phar /usr/local/bin/composer
   ```

### Step 3: Create Laravel Project
1. Navigate to your website directory:
   ```bash
   cd /www/wwwroot/
   ```
2. Create a new Laravel project:
   ```bash
   composer create-project laravel/laravel kmkb-app
   ```
   
   Alternatively, if you want to specify a particular Laravel version:
   ```bash
   composer create-project laravel/laravel=9.* kmkb-app
   ```

### Step 4: Configure Laravel Project Permissions
1. Set proper permissions for Laravel directories:
   ```bash
   cd kmkb-app
   sudo chmod -R 755 storage bootstrap/cache
   sudo chown -R www-data:www-data .
   ```

### Step 5: Configure Apache/Nginx for Laravel

#### For Apache:
1. In aaPanel, go to "Website" → "Add Site"
2. Fill in the domain details (you can use a subdomain or IP for development)
3. Set the document root to `/www/wwwroot/kmkb-app/public`
4. Click "Submit" to create the site

#### For Nginx:
1. In aaPanel, go to "Website" → "Add Site"
2. Fill in the domain details
3. Set the document root to `/www/wwwroot/kmkb-app/public`
4. After creating the site, go to "Website" → "Site Configuration"
5. Select your site and click on "Configuration File"
6. Replace the default Nginx configuration with Laravel-specific configuration:
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;
       root /www/wwwroot/kmkb-app/public;
       index index.php index.html index.htm;

       location / {
           try_files $uri $uri/ /index.php?$query_string;
       }

       location ~ \.php$ {
           include snippets/fastcgi-php.conf;
           fastcgi_pass unix:/run/php/php8.1-fpm.sock; # Adjust PHP version as needed
           fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
           include fastcgi_params;
       }

       location ~ /\.ht {
           deny all;
       }
   }
   ```

### Step 6: Configure Environment Variables
1. In aaPanel, navigate to your project directory
2. Rename the `.env.example` file to `.env`:
   ```bash
   cd /www/wwwroot/kmkb-app
   mv .env.example .env
   ```
3. Generate the application key:
   ```bash
   php artisan key:generate
   ```

### Step 7: Configure Database Connection
1. Edit the `.env` file to configure database settings:
   ```bash
   nano .env
   ```
2. Update the database configuration section:
   ```env
   DB_CONNECTION=mysql
   DB_HOST=127.0.0.1
   DB_PORT=3306
   DB_DATABASE=kmkb_db
   DB_USERNAME=your_db_user
   DB_PASSWORD=your_secure_password
   ```
3. Save and exit the file

### Step 8: Test Laravel Installation
1. Access your domain or IP in a web browser
2. You should see the Laravel welcome page
3. Test database connection:
   ```bash
   php artisan migrate
   ```

## Laravel Project Structure for KMKB

After successful installation, your Laravel project will have the following structure:

```
kmkb-app/
├── app/
├── bootstrap/
├── config/
├── database/
├── public/
├── resources/
├── routes/
├── storage/
├── tests/
├── vendor/
├── .env
├── artisan
├── composer.json
└── README.md
```

## Setting Up Laravel Modules for KMKB

Based on the BRD requirements, you'll need to set up the following modules:

### 1. User Management & Security Module
- Create User model and migration:
  ```bash
  php artisan make:model User -m
  ```
- Create authentication controllers:
  ```bash
  php artisan make:controller Auth\LoginController
  php artisan make:controller Auth\RegisterController
  ```

### 2. Clinical Pathway Module
- Create models for pathway entities:
  ```bash
  php artisan make:model ClinicalPathway -m
  php artisan make:model PathwayStep -m
  php artisan make:model PatientCase -m
  php artisan make:model CaseDetail -m
  ```

### 3. Data Management Module
- Create controllers for data handling:
  ```bash
  php artisan make:controller DataController
  php artisan make:controller UploadController
  ```

### 4. Reporting & Analytics Module
- Create dashboard controller:
  ```bash
  php artisan make:controller DashboardController
  ```

## Laravel Configuration for KMKB

### 1. Configure Authentication
1. Run the Laravel authentication scaffolding:
   ```bash
   composer require laravel/ui
   php artisan ui bootstrap --auth
   npm install
   npm run dev
   ```

### 2. Configure Database Migrations
Laravel migrations will be used to manage database schema changes as recommended in the BRD:

1. Create initial migrations for all models:
   ```bash
   php artisan make:migration create_clinical_pathways_table
   php artisan make:migration create_pathway_steps_table
   php artisan make:migration create_patient_cases_table
   php artisan make:migration create_case_details_table
   ```

### 3. Configure Security Features
Laravel provides built-in security features that align with the BRD requirements:

1. CSRF protection is enabled by default
2. SQL injection prevention through Eloquent ORM
3. Password hashing using bcrypt
4. Session management

### 4. Configure Logging for Audit Trail
1. Laravel's built-in logging can be used for audit trails:
   ```php
   Log::info('User performed action', ['user_id' => $user->id, 'action' => 'pathway_updated']);
   ```

## Testing Laravel Installation

1. Run Laravel's built-in development server to test:
   ```bash
   php artisan serve
   ```
2. Access the application through your browser
3. Verify all components are working correctly

## Troubleshooting Common Issues

### 1. Permission Issues
- Ensure proper file permissions:
  ```bash
  sudo chmod -R 755 storage bootstrap/cache
  sudo chown -R www-data:www-data .
  ```

### 2. Database Connection Issues
- Verify database credentials in `.env` file
- Check if MySQL service is running
- Ensure the database user has proper permissions

### 3. Routing Issues
- For Apache, ensure `mod_rewrite` is enabled
- For Nginx, verify the configuration file is correct

### 4. PHP Extension Issues
- Ensure all required PHP extensions are installed:
  - OpenSSL
  - PDO
  - Mbstring
  - Tokenizer
  - XML
  - Ctype
  - JSON

## Next Steps

After successfully setting up Laravel:

1. Begin implementing the User Management module
2. Set up version control (Git) for the project
3. Create the initial database schema using Laravel migrations
4. Start developing the Pathway Builder feature

## Useful Laravel Commands

```bash
# Generate application key
php artisan key:generate

# Run migrations
php artisan migrate

# Create a new controller
php artisan make:controller ControllerName

# Create a new model with migration
php artisan make:model ModelName -m

# Create a new migration
php artisan make:migration migration_name

# Run development server
php artisan serve

# Clear cache
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear
```

## Conclusion

With Laravel properly configured, you now have a solid foundation for developing the KMKB application. Laravel's features align well with the requirements specified in the BRD, including:

- Built-in authentication and authorization
- Database migration system for schema management
- Security features (CSRF protection, SQL injection prevention)
- Modular structure for easy development and maintenance
- Logging capabilities for audit trails

This setup provides everything needed to begin implementing the core features of the KMKB application.
